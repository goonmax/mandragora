#!/bin/bash
le_tag="$1"; 
if [[ $# -eq 2 ]]; then 
    show_tags=1
else
    show_tags=0
fi
le_tag="$1"; 
shopt -s nocasematch
if [[ ! -z $le_tag ]]; then
    # find . -name '*.jpg' -print0 | xargs -0 -I{} sh -c 'qit "{}" 2>/dev/null | sed "/^\s\+$/d" | grep -v Warning | grep '$le_tag' | xargs -I% echo "{}" %'
    find . -name '*.jpg' | while read le_file; do
        le_tags="`qit $le_file 2>/dev/null`"
        if [[ 
            "$le_tags" =~ "$le_tag"
            && ! -z "$le_tags" 
            && ! ${le_tags:0:2} == "==" 
            && ! "$le_tags" =~ "Warning" ]]; then
            if [[ $show_tags -eq 1 ]]; then
                echo "$le_file $le_tags"
            else
                echo "$le_file"
            fi
        fi
    done
fi
shopt -u nocasematch
